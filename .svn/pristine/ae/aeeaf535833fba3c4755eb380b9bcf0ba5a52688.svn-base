<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

use App\Http\Requests;
use App\Http\Controllers\Controller;

use App\Http\Requests\VGalleryRequest;
use App\Http\Requests\VGalleryAlbumsRequest;
use App\Http\Requests\GeneralRequest;

use App\VGalleryAlbums;
use App\VGallery;

use Laracasts\Flash\Flash;

class VGalleryController extends Controller
{
    /**
     * Display a listing of the resource.
     *
     * @return Response
     */
    public function index()
    {
        $albums = VGalleryAlbums::paginate(15);
        return view('backend.vgallery.vgallery_list', compact('albums'));
    }

    /**
     * Search a listing of the resource.
     *
     * @return Response
     */
    public function operations(GeneralRequest $request)
    {
        if($request->input('delete')) {      
            if(!empty($_POST['check_list'])) {
                foreach($_POST['check_list'] as $album_id) {
                    VGalleryAlbums::find($album_id)->delete();
                    vGallery::where('vgallery_id', '=', $album_id)->delete();
                }
                Flash::success('تم الحذف بنجاح');
            }
            else{
                Flash::warning('لم يتم الاختيار', 'alert-class');
            }
            return redirect('admin/vgallery/list');
        }
    }

    /**
     * Show the form for creating a new resource.
     *
     * @return Response
     */
    public function create_album()
    {
        return view('backend.vgallery.create_album');
    }

    /**
     * Store a newly created resource in storage.
     *
     * @param  Request  $request
     * @return Response
     */
    public function store_album(VGalleryAlbumsRequest $request)
    {
        $album = new VGalleryAlbums;
        $album->name = $request->input('name');
        $album->save();
        Flash::success('تم الحفظ بنجاح');
        return redirect('admin/vgallery/create');
    }

    /**
     * Show the form for creating a new resource.
     *
     * @return Response
     */
    public function create()
    {
        $albums = VGalleryAlbums::all();
        return view('backend.vgallery.videos_form', compact('albums'));
    }

    /**
     * Store a newly created resource in storage.
     *
     * @param  Request  $request
     * @return Response
     */
    public function store(VGalleryRequest $request)
    {
        $videos = new VGallery;
        $videos->name = $request->input('name');
        $videos->link = $request->input('link');
        $videos->summary = $request->input('summary');
        $videos->vgallery_id = $request->input('vgallery_id');
        $videos->save();
        Flash::success('تم الحفظ بنجاح');
        return redirect('admin/vgallery/create');  
    }

    /**
     * Show the form for editing the specified resource.
     *
     * @param  int  $id
     * @return Response
     */
    public function edit($id)
    {
        $albums = VGalleryAlbums::find($id);
        $videos = VGallery::where('vgallery_id', '=', $id)->get();
        return view('backend.vgallery.edit_albums', compact('albums', 'videos'));
    }

    /**
     * Update the specified resource in storage.
     *
     * @param  Request  $request
     * @param  int  $id
     * @return Response
     */
    public function update(GeneralRequest $request, $id)
    {
        if($request->input('edit')) {
            if (empty($request->input('name'))) {
                Flash::warning('ادخال الحقل اسم الالبوم ضروري لاتمام عملية التعديل', 'alert-class');
                return redirect('admin/vgallery/' . $id . '/edit');
            }
            $album = VGalleryAlbums::find($id);
            $album->name = $request->input('name');
            $album->update();
            Flash::success('تم التعديل بنجاح');
        }
        if($request->input('delete')) {      
            if(!empty($_POST['check_list'])) {
                foreach($_POST['check_list'] as $album_id) {
                    vGallery::where('id', '=', $album_id)->delete();
                }
                Flash::success('تم الحذف بنجاح');
            }
            else{
                Flash::warning('لم يتم الاختيار', 'alert-class');
            }
        }
        return redirect('admin/vgallery/' . $id . '/edit');
    }


    /**
     * Show the form for editing the specified resource.
     *
     * @param  int  $id
     * @return Response
     */
    public function edit_video($id)
    {
        $albums = VGalleryAlbums::all();
        $videos = VGallery::find($id);
        return view('backend.vgallery.edit_videos', compact('videos', 'albums'));
    }

    /**
     * Update the specified resource in storage.
     *
     * @param  Request  $request
     * @param  int  $id
     * @return Response
     */
    public function update_video(VGalleryRequest $request, $id)
    {
        $video = VGallery::find($id);
        $video->name = $request->input('name');
        $video->link = $request->input('link');
        $video->summary = $request->input('summary');
        $video->vgallery_id = $request->input('vgallery_id');
        $video->update();
        Flash::success('تم التعديل بنجاح');
        return redirect('admin/vgallery/video/' . $id . '/edit');
    }


    /**
     * Display the specified resource.
     *
     * @param  int  $id
     * @return Response
     */
    public function show($id)
    {
        $albums = VGalleryAlbums::find($id);
        return view('backend.vgallery.delete_albums', compact('albums'));
    }

    /**
     * Remove the specified resource from storage.
     *
     * @param  int  $id
     * @return Response
     */
    public function destroy($id)
    {
        $album = VGalleryAlbums::find($id);
        $album->delete();
        Flash::success("تم الحذف بنجاح");
        return redirect('admin/vgallery/list');
    }

    /**
     * Display the specified resource.
     *
     * @param  int  $id
     * @return Response
     */
    public function show_video($id)
    {
        $video = VGallery::find($id);
        return view('backend.vgallery.delete_videos', compact('video'));
    }

    /**
     * Remove the specified resource from storage.
     *
     * @param  int  $id
     * @return Response
     */
    public function destroy_video($id)
    {
        $video = VGallery::find($id);
        $album_id = $video['attributes']['vgallery_id'];
        $video->delete();
        Flash::success("تم الحذف بنجاح");
        return redirect('admin/vgallery/' . $album_id . '/edit');
    }

    /**
     * Display a listing of the resource.
     *
     * @return Response
     */
    public function albums_list(){
        $albums = VGalleryAlbums::all();
        $videos = VGallery::all();
        return view('frontend.vgallery.albums_list', compact('albums', 'videos'));
    }
}
